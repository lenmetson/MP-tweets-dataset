---
title: "MP Tweets Dataset Notebook"
output: html_notebook
---

# Pulling British MPs' Tweets

The aim of this mini-project is to create a dataset of British MPs' tweets. In order to do this, an academic

## Set-up

In order to run the code, an academic developer licence is required to access Twitter's API.

Once you have an academic licence:

-   Copy your bearer token

-   Load the `academictwitteR` package

-   Run the command `set_bearer()` and follow the instructions

-   They involve making a file called `.Renviron` in the root directory and typing:

    -   `TWITTER_BEARER=AAAA…`, where `AAAA…` is your own bearer token

-   You can also set your bearer token manually, but this is less secure because it might appear in `.Rhistory` files or scripts. This is especially a problem if they are shared files.

The rest of the code can be run from this repository

## Code

```{r}
if (!require("here")) install.packages("here")
source(here("code", "01_packages.R"))
```

Helpfully, [Michael Keith](https://www.michaelkeith.co.uk/) has created a [online dashboard](https://www.politics-social.com/) of British MPs' Twitter activity. On the website, there are `.csv` files which allow us to pull MPs' usernames. Run the following script:

```{r}
source(here("code", "1_pull-latest-MPs.R"))
```

Next, we use this dataset to pull each MP's Twitter user ID by their user display name. The following script:

-   Extracts usernames and cleans them

-   Splits the user names into batches of no more than 100 users at a time then requests their ids from the Twitter API.

-   Finally, it binds them together and outputs a dataframe called `user_ids`

```{r}
source(here("code", "2_extract-twitter-ids.R"))
```

There are some differences between the number of Twitter MPs and the ones that are pulled, and by the automerging process compared to manually merging. I am going to investigate in the following code:

```
# Bind back into MPs_Twitter 

user_ids$Screen.name <- paste0("@", user_ids$username) # add back @ symbol 

user_ids <- user_ids %>% rename(
  "twiter_name_at_pull" = "name",
  "username_for_pull" = "username"
)

MPs_Twitter_with_ids <- left_join(MPs_Twitter, user_ids, by = "Screen.name")

```

This code chunk is present in the `2_extract-twitter-ids.R` script. Manually inspect missing MPs

```{r}
missing_ids <- MPs_Twitter_with_ids %>% filter(is.na(id))
```

